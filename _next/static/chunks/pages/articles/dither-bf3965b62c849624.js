(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[671],{8335:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/dither",function(){return n(3501)}])},7152:function(e,t,n){"use strict";var r=n(5893);t.Z=function(e){var t=e.children,n=t;if("string"===typeof t)n=t.trimEnd().replace(/ (?!.* )/,"\xa0");else if(Array.isArray(t)&&"string"===typeof t[t.length-1]){var i=t[t.length-1].trimEnd().replace(/ (?!.* )/,"\xa0");n=t.slice(0,-1).concat(i)}return(0,r.jsx)("p",{children:n})}},5755:function(e,t,n){"use strict";n.d(t,{me:function(){return b},ZP:function(){return w},he:function(){return j}});var r=n(5893),i=n(7294),a=n(4184),o=n.n(a),s=n(5656),l=n(867),c=n.n(l);var h=function(e){var t,n,i,a=e.toggled;return(0,r.jsxs)("div",{className:o()(c().expandToggle,(t={},n=c().toggled,i=a,n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t)),children:[(0,r.jsx)("span",{style:{"--n":-1}}),(0,r.jsx)("span",{style:{"--n":0}}),(0,r.jsx)("span",{style:{"--n":1}})]})},d=n(2729),u=n.n(d);var m=function(e){var t,n,i,a=e.toggled;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",width:"1em",height:"1em",className:o()(u().themeToggle,(t={},n=u().toggled,i=a,n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t)),fill:"currentColor",viewBox:"0 0 32 32",children:[(0,r.jsx)("clipPath",{id:"theme-toggle__within__clip",children:(0,r.jsx)("path",{d:"M0 0h32v32h-32ZM6 16A1 1 0 0026 16 1 1 0 006 16"})}),(0,r.jsx)("g",{clipPath:"url(#theme-toggle__within__clip)",children:(0,r.jsx)("path",{d:"M30.7 21.3 27.1 16l3.7-5.3c.4-.5.1-1.3-.6-1.4l-6.3-1.1-1.1-6.3c-.1-.6-.8-.9-1.4-.6L16 5l-5.4-3.7c-.5-.4-1.3-.1-1.4.6l-1 6.3-6.4 1.1c-.6.1-.9.9-.6 1.3L4.9 16l-3.7 5.3c-.4.5-.1 1.3.6 1.4l6.3 1.1 1.1 6.3c.1.6.8.9 1.4.6l5.3-3.7 5.3 3.7c.5.4 1.3.1 1.4-.6l1.1-6.3 6.3-1.1c.8-.1 1.1-.8.7-1.4zM16 25.1c-5.1 0-9.1-4.1-9.1-9.1 0-5.1 4.1-9.1 9.1-9.1s9.1 4.1 9.1 9.1c0 5.1-4 9.1-9.1 9.1z"})}),(0,r.jsx)("path",{className:u().themeToggleCircle,d:"M16 7.7c-4.6 0-8.2 3.7-8.2 8.2s3.6 8.4 8.2 8.4 8.2-3.7 8.2-8.2-3.6-8.4-8.2-8.4zm0 14.4c-3.4 0-6.1-2.9-6.1-6.2s2.7-6.1 6.1-6.1c3.4 0 6.1 2.9 6.1 6.2s-2.7 6.1-6.1 6.1z"}),(0,r.jsx)("path",{className:u().themeToggleInner,d:"M16 9.5c-3.6 0-6.4 2.9-6.4 6.4s2.8 6.5 6.4 6.5 6.4-2.9 6.4-6.4-2.8-6.5-6.4-6.5z"})]})},g=n(7584),p=n.n(g);var f=function(e){var t,n,i,a=e.toggled;return(0,r.jsxs)("div",{className:o()(p().fontToggle,(t={},n=p().toggled,i=a,n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t)),children:[(0,r.jsx)("span",{className:p().sans,children:"A"}),(0,r.jsx)("span",{className:p().serif,children:"A"})]})},x=n(1818),v=n.n(x);var w=function(e){var t,n,a,l=e.show,c=(0,i.useContext)(s.SettingsCtx),d=c.dark,u=c.setDark,g=c.serif,p=c.setSerif,x=(0,i.useState)(!1),w=x[0],j=x[1];return(0,r.jsx)("div",{className:v().anchor,children:(0,r.jsxs)("div",{className:o()(v().container,(t={},n=v().expanded,a=l.length<2||w,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)),children:[l.length>1&&(0,r.jsx)("button",{className:v().expandToggle,"aria-label":"Open/close settings",onClick:function(){return j(!w)},children:(0,r.jsx)(h,{toggled:w})}),l.includes("theme")&&(0,r.jsx)("button",{onClick:function(){return u(!d)},"aria-label":"Theme toggle",style:{"--n":1},children:(0,r.jsx)(m,{toggled:d})}),l.includes("font")&&(0,r.jsx)("button",{onClick:function(){return p(!g)},"aria-label":"Font toggle",style:{"--n":2},children:(0,r.jsx)(f,{toggled:g})})]})})},j=["theme"],b=["theme","font"]},255:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(5893),i=n(9008),a=n(4184),o=n.n(a),s=n(1664),l=n(5957),c=n.n(l),h=function(e){var t=e.crumbs;return(0,r.jsx)("nav",{className:c().crumbs,children:t.map((function(e,t){return(0,r.jsxs)("span",{className:c().crumb,children:[(0,r.jsx)(s.default,{href:e.path,children:e.name}),"/"]},t)}))})},d=n(5755),u=n(2071),m=n.n(u),g=function(e){var t=e.title,n=e.crumbs,a=e.settings,s=e.children,l=a||d.he;return(0,r.jsxs)("div",{className:m().layoutRoot,children:[(0,r.jsx)(i.default,{children:(0,r.jsx)("title",{children:t})}),(0,r.jsx)("header",{className:o()(m().mainContent,m().header),children:(0,r.jsxs)("div",{className:m().headerContent,children:[n&&(0,r.jsx)(h,{crumbs:n}),(0,r.jsx)("h1",{children:t})]})}),(0,r.jsx)("aside",{className:o()(m().mainContent,m().settings),children:(0,r.jsx)(d.ZP,{show:l})}),(0,r.jsx)("main",{className:m().mainContent,children:s})]})}},4778:function(e,t,n){"use strict";n.d(t,{xr:function(){return r},No:function(){return i}});var r={name:"home",path:"/"},i={name:"articles",path:"/articles"}},3501:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe},meta:function(){return fe}});var r=n(5893),i=n(1151),a=n(255),o=n(7152),s=n(7294),l=n(2754),c=n.n(l),h=function(){var e=(0,s.useState)(0),t=e[0],n=e[1];return(0,s.useEffect)((function(){var e=function(){var e=document.body.getBoundingClientRect().height-window.innerHeight,t=window.scrollY;n(t/e*100)};return window.addEventListener("scroll",e),function(){return window.removeEventListener("scroll",e)}}),[]),(0,r.jsx)("progress",{className:c().progress,max:100,value:t})},d=n(5755),u=n(4778),m={p:o.Z},g=function(e){var t=e.meta,n=e.children;return(0,r.jsxs)(a.Z,{title:t.title,crumbs:[u.xr,u.No],settings:d.me,children:[(0,r.jsx)(h,{}),(0,r.jsx)(i.Zo,{components:m,children:(0,r.jsx)("article",{children:n})})]})},p=n(8561),f=n.n(p),x=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],v=function(e){var t=e.showZoom,n=e.showRatio,i=e.initialRatio,a=e.color1,o=void 0===a?"white":a,l=e.color2,c=void 0===l?"black":l,h=(0,s.useState)(1),d=h[0],u=h[1],m=(0,s.useState)(void 0===i?8:i),g=m[0],p=m[1],v=null;return(0,s.useEffect)((function(){var e=null===v||void 0===v?void 0:v.getContext("2d"),t=document.createElement("canvas"),n=t.getContext("2d");if(v&&e&&n){e.imageSmoothingEnabled=!1;var r=window.devicePixelRatio,i=v.getBoundingClientRect();v.width=i.width*r,v.height=i.height*r;var a=v.width/4,s=Math.round(1+d*(a-1));t.width=4*s,t.height=4*s;for(var l=0;l<4;l++)for(var h=0;h<4;h++){var u=x[h%4+l%4*4];n.fillStyle=u<g?o:c,n.fillRect(h*s,l*s,s,s)}var m=e.createPattern(t,"repeat");m&&(e.fillStyle=m,e.fillRect(0,0,v.width,v.height))}else console.warn("Canvas unavailable")}),[v,d,g,o,c]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsx)("div",{className:f().demoFrame,children:(0,r.jsx)("canvas",{className:f().canvas,ref:function(e){return v=e}})}),(0,r.jsxs)("div",{className:f().controls,children:[t&&(0,r.jsxs)("label",{children:["Zoom",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:d,min:0,max:1,step:.005,onChange:function(e){return u(parseFloat(e.target.value))}})]}),n&&(0,r.jsxs)("label",{children:[n,(0,r.jsx)("input",{type:"range",autoComplete:"off",value:g,min:0,max:16,step:1,onChange:function(e){return p(parseInt(e.target.value))}})]})]})]})},w=n(9868),j=n.n(w),b=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],_=function(e){return.299*e[0]+.587*e[1]+.114*e[2]},y=function(e){var t=e.useWhite,n=(0,s.useState)(0),i=n[0],a=n[1],o=(0,s.useState)(.5),l=o[0],c=o[1],h=(0,s.useState)(.5),d=h[0],u=h[1],m=(0,s.useState)(.5),g=m[0],p=m[1],x=null,v=null;return(0,s.useEffect)((function(){var e=null===x||void 0===x?void 0:x.getContext("2d"),n=document.createElement("canvas"),r=n.getContext("2d");if(x&&e&&r){e.imageSmoothingEnabled=!1;var a=window.devicePixelRatio,o=x.getBoundingClientRect();x.width=o.width*a,x.height=o.height*a;var s=x.width/4,c=Math.round(1+i*(s-1));n.width=4*c,n.height=4*c;var h=[l,d,g].map((function(e){return Math.pow(e,2.2)})),u=[[0,0,0],[1,0,0],[0,1,0],[0,0,1]];t&&u.push([1,1,1]);for(var m,p,f=[0,0,0],w=[0,0,0],j=[],y=0;y<16;y++){for(var T=0;T<3;T++)w[T]=h[T]+f[T];for(var E=[0,0,0],C=Number.MAX_VALUE,k=0;k<u.length;k++){var S=(m=w,p=u[k],(m[0]-p[0])*(m[0]-p[0])+(m[1]-p[1])*(m[1]-p[1])+(m[2]-p[2])*(m[2]-p[2]));S<C&&(C=S,E=u[k])}j.push(E);for(var R=0;R<3;R++)f[R]=f[R]+h[R]-E[R]}j.sort((function(e,t){return _(e)-_(t)}));for(var N=0;N<4;N++)for(var z=0;z<4;z++){var A=b[z%4+N%4*4];r.fillStyle="rgb(".concat(j[A].map((function(e){return 255*e})).join(","),")"),r.fillRect(z*c,N*c,c,c)}var F=e.createPattern(n,"repeat");F&&(e.fillStyle=F,e.fillRect(0,0,x.width,x.height)),v&&(v.style.background="rgb(".concat([l,d,g].map((function(e){return 255*e})).join(","),")"))}else console.warn("Canvas unavailable")}),[x,v,i,l,d,g,t]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:f().demoFrame,children:[(0,r.jsx)("canvas",{className:f().canvas,ref:function(e){return x=e}}),(0,r.jsx)("div",{className:j().colorPreview,ref:function(e){return v=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[(0,r.jsxs)("label",{children:["Zoom",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:i,min:0,max:1,step:.005,onChange:function(e){return a(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Red",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:l,min:0,max:1,step:1/256,style:{"--progress-color":"rgb(".concat(255*l,",0,0)")},onChange:function(e){return c(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Green",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:d,min:0,max:1,step:1/256,style:{"--progress-color":"rgb(0,".concat(255*d,",0)")},onChange:function(e){return u(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Blue",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:g,min:0,max:1,step:1/256,style:{"--progress-color":"rgb(0,0,".concat(255*g,")")},onChange:function(e){return p(parseFloat(e.target.value))}})]})]})]})},T=n(4184),E=n.n(T),C=function(e){return e.viewport(0,0,e.canvas.width,e.canvas.height)},k=function(e,t,n){var r=e.createShader(t);if(!r)throw new Error("createShader: gl.createShader failed");if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;var i=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("createShader: compile error: ".concat(i))},S=function(e,t,n,r){e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(t,r.size,r.type,r.normalize||!1,r.stride||0,r.offset||0)},R=function(e,t,n){var r=e.createProgram();if(!r)throw new Error("linkProgram: gl.createProgram failed");if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;var i=e.getProgramInfoLog(r);throw e.deleteProgram(r),new Error("linkProgram: link error: ".concat(i))},N=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.TEXTURE0,o=e.createTexture();if(!o)throw new Error("tex2DFromData: failed to create texture");e.activeTexture(a),e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var s=null;switch(i.type){case e.UNSIGNED_BYTE:s=new Uint8Array(r);break;case e.UNSIGNED_SHORT:case e.UNSIGNED_SHORT_5_6_5:case e.UNSIGNED_SHORT_5_5_5_1:case e.UNSIGNED_SHORT_4_4_4_4:s=new Uint16Array(r);break;case e.UNSIGNED_INT:s=new Uint32Array(r);break;case e.FLOAT:s=new Float32Array(r)}return e.texImage2D(e.TEXTURE_2D,0,i.internalFormat,t,n,0,i.format,i.type,s),o},z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.TEXTURE0,i=e.createTexture();if(!i)throw new Error("tex2DFromImage: failed to create texture");return e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,n.internalFormat,n.format,n.type,t),i},A={size:2,data:[0,4,0,0,2,1,0,0].map((function(e){return 64*e+32}))},F={size:4,data:[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5].map((function(e){return 16*e+8}))},P={size:8,data:[0,48,12,60,3,51,15,63,32,16,44,28,35,19,47,31,8,56,4,52,11,59,7,55,40,24,36,20,43,27,39,23,2,50,14,62,1,49,13,61,34,18,46,30,33,17,45,29,10,58,6,54,9,57,5,53,42,26,38,22,41,25,37,21].map((function(e){return 4*e+2}))},D={size:16,data:[111,49,141,161,113,194,71,176,200,50,150,94,66,37,85,251,25,99,238,221,32,249,147,19,38,106,219,169,193,137,13,166,125,177,79,15,65,172,123,87,212,130,246,23,116,54,228,211,41,201,151,131,188,104,53,235,160,62,1,180,77,240,146,68,2,243,56,91,229,5,203,28,186,101,143,205,33,92,189,107,222,163,114,36,213,155,138,70,244,84,225,48,126,157,17,134,83,195,21,253,76,45,178,115,12,40,168,105,252,175,210,59,100,179,144,122,171,97,234,128,214,148,198,8,72,26,237,44,231,31,69,11,204,58,18,192,88,60,112,220,139,86,120,152,207,129,242,159,223,110,34,247,164,24,233,183,52,197,170,6,108,187,51,89,136,185,153,78,47,133,98,156,35,248,95,63,16,75,218,39,0,67,227,121,196,239,3,74,127,20,226,142,245,174,119,199,250,103,145,14,208,173,109,217,191,82,202,162,29,93,149,22,165,181,55,30,90,64,42,140,167,57,117,46,215,232,61,128,81,236,216,118,158,254,184,27,241,102,4,132,73,190,9,209,43,96,7,135,230,80,10,124,224,206,154,182]},I={size:64,data:[65,246,203,177,54,148,96,135,122,62,109,205,27,217,151,103,250,78,122,228,3,83,232,160,45,241,109,40,125,93,201,36,230,187,254,206,147,14,87,134,245,197,177,223,59,92,132,169,49,182,140,3,58,164,27,204,12,83,196,5,159,183,92,196,170,140,24,127,109,255,36,210,79,192,178,141,168,11,70,130,181,27,147,47,191,170,67,14,187,76,0,197,161,66,146,172,104,134,58,97,182,231,162,115,34,74,2,237,162,187,7,242,217,31,69,193,243,87,146,130,248,172,224,104,235,21,217,117,236,49,87,154,228,69,15,166,235,25,48,86,119,238,195,91,7,221,165,105,21,255,120,146,210,129,88,236,22,52,244,18,74,157,25,8,126,43,64,189,218,95,128,24,207,46,113,145,85,102,228,119,41,106,222,66,50,152,32,126,47,144,57,10,191,104,213,4,43,196,181,104,146,1,223,252,60,34,161,45,244,61,208,133,89,199,37,56,245,29,174,151,114,189,211,127,179,238,215,194,246,109,26,240,170,52,155,108,81,249,28,195,60,175,153,19,208,176,16,186,114,210,93,72,178,203,82,162,28,72,179,241,160,83,120,55,213,128,155,100,180,136,213,106,144,117,31,230,71,154,177,106,94,224,47,69,229,99,83,4,46,114,87,141,72,156,202,80,139,13,232,181,137,67,159,212,10,130,253,77,52,160,234,80,6,241,192,19,253,111,227,131,247,147,115,60,133,207,26,248,91,68,31,202,13,78,229,16,201,82,183,52,240,18,220,8,139,163,202,13,134,32,164,223,198,63,33,169,51,223,101,20,116,211,61,198,36,226,121,93,236,38,200,97,141,123,33,102,139,165,58,133,157,4,96,41,198,13,219,98,17,226,144,40,189,172,236,113,53,189,126,67,173,156,4,101,141,114,204,63,191,79,118,240,185,57,143,247,103,154,229,121,1,178,39,149,186,253,89,4,101,172,17,185,55,112,167,0,215,246,63,203,227,43,86,219,34,206,65,172,80,51,186,37,171,73,110,161,10,219,81,140,163,241,26,95,252,39,215,193,170,44,85,125,249,22,40,149,108,207,76,21,130,13,183,252,94,209,240,129,68,45,165,127,242,48,152,82,142,222,71,29,179,86,189,150,24,176,122,104,184,141,238,120,225,135,89,253,125,193,242,61,97,123,45,5,212,104,148,50,223,135,120,75,247,29,228,158,53,176,213,88,5,168,43,191,90,213,74,29,135,59,84,9,225,110,27,145,215,70,204,250,22,194,155,242,133,46,8,115,73,249,15,233,77,48,23,154,106,165,205,2,152,49,25,206,232,150,183,251,66,35,203,185,20,86,57,11,150,96,186,3,137,234,102,64,254,221,119,231,173,54,148,201,162,115,195,173,153,203,234,79,188,114,6,131,105,43,91,118,59,226,162,95,213,136,55,193,163,94,211,10,240,28,64,232,104,84,177,137,74,18,198,89,131,171,77,113,160,235,199,225,128,66,209,108,75,35,155,196,132,29,157,67,112,36,239,105,19,46,220,33,93,53,11,178,58,34,226,169,64,182,235,206,19,107,198,236,39,157,204,1,127,251,177,72,191,122,42,143,198,13,218,119,35,108,54,159,23,240,219,0,143,100,177,37,166,243,16,173,224,123,20,183,50,82,16,244,141,3,217,81,185,249,142,73,107,245,124,137,99,156,239,87,201,11,135,35,170,143,69,181,28,88,110,67,147,30,115,54,150,174,221,76,163,240,58,156,248,173,226,213,99,120,60,43,246,67,17,110,52,144,89,199,57,245,94,208,146,105,178,205,94,190,128,65,170,8,122,229,22,193,162,218,16,195,46,123,30,158,73,216,84,254,13,53,130,244,173,230,43,220,201,86,244,23,94,131,33,114,95,190,3,84,140,40,10,146,178,194,130,210,80,190,218,25,119,42,139,163,11,70,238,219,124,57,162,44,228,152,97,57,209,156,180,66,42,86,253,71,143,103,224,248,113,178,44,124,223,104,150,215,23,81,184,101,137,6,111,210,52,229,179,17,212,45,131,235,63,187,206,81,231,93,29,163,121,253,152,71,237,187,80,215,116,43,168,6,34,77,252,12,113,30,238,198,39,83,131,3,232,112,27,167,214,2,187,54,96,148,5,196,161,75,189,7,119,58,159,18,234,68,185,158,11,193,65,246,144,72,204,27,122,105,255,157,52,12,223,141,40,6,92,207,172,2,31,102,251,142,191,91,234,197,135,182,87,211,138,16,116,247,98,212,146,201,182,59,130,82,153,17,207,241,63,91,237,32,205,96,144,250,198,126,169,40,254,98,139,121,86,169,107,160,93,182,168,15,70,33,117,173,106,62,233,183,55,132,107,158,230,198,59,24,128,64,111,151,21,221,53,166,75,177,190,62,30,172,52,121,92,237,38,245,171,69,34,128,183,24,117,49,168,67,221,34,88,51,214,78,29,57,206,232,41,22,221,8,249,54,227,152,197,132,215,245,76,204,169,101,22,243,45,66,124,88,180,225,157,211,175,47,102,68,127,245,106,47,226,158,136,241,77,10,155,19,105,197,118,225,142,105,229,153,215,138,245,17,130,176,229,3,116,148,129,172,7,75,152,199,60,117,35,138,80,43,241,87,20,185,149,9,128,81,220,193,140,212,16,148,50,8,81,32,248,0,231,204,155,27,5,147,88,12,109,219,41,185,228,207,138,49,21,190,85,167,14,56,80,101,187,43,111,74,156,103,240,195,90,225,111,243,178,127,237,189,210,100,218,3,112,165,56,98,35,48,249,156,114,34,177,79,249,166,110,240,99,199,123,143,88,171,39,194,216,125,254,203,25,194,96,128,61,164,78,234,97,60,212,42,243,200,175,0,230,150,209,192,25,62,180,16,69,35,144,50,99,28,88,71,151,173,125,66,181,140,200,232,119,213,191,18,69,235,7,98,200,39,218,184,138,55,73,186,16,115,79,236,99,66,181,80,57,166,148,251,31,114,7,176,149,253,9,133,71,114,32,126,64,88,12,246,142,220,45,207,249,158,188,216,15,137,164,48,10,23,193,235,31,222,15,70,163,142,60,91,168,146,121,57,133,20,65,119,13,229,160,212,241,58,137,177,51,160,33,134,239,118,1,71,216,90,189,220,33,121,161,184,94,225,157,252,203,166,53,98,122,82,164,134,118,1,83,63,202,252,184,227,109,246,91,145,49,103,128,84,242,2,108,227,200,45,215,187,238,154,91,207,174,44,26,95,36,153,223,7,119,209,16,222,92,175,50,197,139,242,45,131,70,106,204,23,144,194,47,106,22,136,216,36,173,231,28,95,236,175,224,125,103,39,76,214,132,58,201,78,159,252,208,29,175,188,37,132,254,27,85,107,164,30,246,76,147,107,252,132,201,109,23,249,88,192,149,107,40,231,211,23,106,154,18,166,237,51,82,245,62,6,86,178,77,239,112,184,68,10,193,55,108,43,23,167,148,9,118,153,27,168,38,121,178,6,62,154,96,223,54,76,153,176,4,71,222,51,128,190,3,217,81,168,65,184,75,166,46,232,72,186,12,158,77,124,180,63,84,193,2,214,175,36,218,130,236,149,41,191,4,131,248,153,205,143,213,73,197,243,85,229,179,65,96,209,239,19,218,112,194,43,135,117,207,12,101,124,233,141,201,15,101,231,60,117,195,48,12,125,206,101,139,25,127,245,54,141,98,247,35,227,208,96,118,137,152,100,114,165,207,15,223,60,161,90,47,104,79,18,254,156,135,57,32,204,48,248,2,187,136,70,90,143,232,79,247,21,164,243,183,59,194,35,114,172,151,41,180,24,156,235,223,146,243,36,220,62,174,86,115,206,191,5,169,52,142,250,29,64,232,10,190,49,69,122,102,142,200,235,30,225,126,179,93,5,120,97,187,111,137,162,78,104,225,46,165,30,183,10,202,66,145,83,217,44,159,93,251,65,207,85,242,140,99,31,89,57,1,160,113,198,7,214,163,20,66,221,129,112,12,160,180,44,198,76,255,92,27,174,245,83,19,116,168,187,61,37,165,50,222,173,12,218,21,233,125,151,14,198,251,57,102,125,170,49,110,32,134,17,237,78,8,132,226,20,124,72,205,171,115,191,80,180,93,251,151,37,236,47,94,148,79,237,201,71,90,220,126,19,157,136,230,186,37,210,54,71,216,9,147,230,69,193,240,76,147,60,90,192,37,55,177,114,131,214,157,224,92,238,195,228,98,205,119,177,215,49,96,165,196,6,255,44,135,239,216,23,131,50,103,77,123,178,254,26,187,40,103,21,242,147,105,171,209,59,111,11,162,124,150,251,134,99,206,112,141,17,33,206,127,251,169,72,212,244,92,26,82,4,71,39,19,150,180,1,167,70,143,24,155,188,35,145,55,109,219,65,19,152,39,70,233,189,15,227,136,195,109,160,215,60,170,132,188,54,34,82,226,40,145,74,195,94,1,178,42,84,26,246,125,89,107,157,45,100,29,121,5,158,203,234,145,188,244,208,116,79,61,129,47,248,192,58,105,246,116,234,177,82,158,185,98,202,122,173,145,61,166,204,28,55,1,85,121,140,230,209,4,118,249,200,8,98,246,214,50,234,220,108,199,158,56,174,41,212,234,177,8,199,227,184,106,134,65,45,167,108,55,175,140,254,23,220,90,113,36,230,83,3,70,200,16,32,126,230,9,84,250,107,11,213,115,90,156,72,222,242,15,32,76,46,87,158,176,68,133,190,168,116,21,132,34,64,240,14,225,188,2,148,61,82,136,239,53,149,83,220,17,99,225,31,126,8,192,100,160,203,185,16,148,209,127,172,218,136,93,241,143,53,214,164,48,196,32,79,247,41,235,144,102,173,205,183,152,100,238,215,18,108,151,28,86,61,181,154,78,170,143,116,95,75,166,220,192,21,115,68,165,13,40,253,176,196,76,154,237,87,44,230,30,136,77,239,164,95,48,22,156,61,44,205,181,71,118,26,140,94,224,179,132,7,184,200,126,48,65,248,112,195,26,127,56,233,42,219,239,6,207,250,91,189,28,211,134,253,103,121,48,248,181,96,217,129,191,59,117,138,22,202,60,169,216,68,109,53,122,5,64,195,226,183,102,249,113,167,6,103,243,191,64,236,150,55,162,97,67,20,34,163,90,134,7,168,69,142,182,201,78,124,162,142,104,39,123,12,233,49,66,33,144,14,90,160,36,205,24,109,232,92,159,1,244,111,94,130,16,183,153,246,176,221,141,31,74,133,11,211,29,147,81,222,39,174,124,2,111,21,209,121,221,253,110,214,18,229,53,219,38,253,93,1,171,100,50,71,192,222,57,202,109,162,182,198,237,209,226,64,140,243,153,74,171,33,212,49,179,219,38,250,144,205,9,84,210,44,106,253,118,233,86,191,68,235,197,133,15,156,86,217,75,245,194,44,84,170,142,188,77,150,117,202,81,159,120,31,211,247,14,232,26,134,168,147,74,244,9,83,53,27,170,126,4,84,51,201,9,241,131,85,69,149,25,191,77,117,35,163,96,20,150,180,56,167,41,155,122,48,95,59,253,203,46,185,167,35,137,154,10,56,234,99,40,246,178,102,14,189,228,60,135,185,154,113,177,83,6,227,41,93,154,130,180,73,98,195,111,230,184,123,63,146,106,188,231,123,165,54,103,223,63,241,129,198,79,8,203,25,138,221,0,181,164,24,114,100,144,233,61,106,91,226,181,72,131,2,210,60,22,137,239,47,107,148,75,39,89,208,62,254,99,120,214,20,205,114,37,222,147,254,44,19,166,97,222,21,207,41,10,97,210,14,235,171,140,189,52,229,159,216,92,110,238,73,103,247,214,140,229,72,9,28,130,206,14,249,112,198,31,161,121,194,92,156,68,215,10,200,236,20,224,127,46,198,32,186,136,173,63,247,160,190,12,58,134,217,150,34,248,80,174,157,253,65,195,130,43,88,27,1,109,69,30,123,246,61,172,196,131,20,64,35,188,170,215,155,241,79,172,26,51,150,222,242,80,171,226,34,129,164,88,175,123,101,168,3,141,160,238,70,50,234,105,1,92,120,79,174,199,89,70,118,190,136,56,115,30,141,81,244,155,184,120,209,251,176,143,46,185,149,16,38,89,158,205,82,125,45,89,117,54,193,146,124,212,87,103,44,141,17,52,252,112,187,28,248,42,67,194,243,80,108,14,151,87,29,196,139,46,211,231,25,106,244,13,49,232,5,94,200,221,181,4,107,217,72,232,149,39,85,102,227,5,81,211,228,53,179,112,237,18,197,250,178,3,98,40,237,63,167,7,185,69,208,100,199,3,78,222,55,139,155,216,31,58,176,205,217,126,164,225,68,19,243,155,128,38,208,182,154,212,168,74,238,45,122,163,55,34,17,97,59,165,192,23,204,134,164,106,121,143,244,4,153,99,139,67,32,224,204,73,187,138,24,248,110,228,130,152,174,63,144,119,204,8,111,183,92,121,230,23,98,6,252,111,182,145,99,52,72,167,139,61,101,128,28,110,149,20,89,229,193,145,175,203,129,11,218,116,237,54,68,254,28,190,74,40,217,56,228,163,113,133,159,107,11,219,120,201,155,36,13,87,231,43,242,160,90,234,74,25,251,149,41,135,192,78,56,38,204,171,7,194,223,113,2,227,80,42,250,186,59,172,209,69,132,247,80,110,239,47,75,157,91,37,199,175,12,221,94,169,129,184,12,78,240,19,56,253,174,91,50,77,177,58,243,122,24,192,102,35,18,188,171,132,51,200,166,64,243,179,156,130,82,29,117,251,88,178,23,241,161,199,11,219,135,241,7,103,42,26,219,3,183,138,249,174,15,127,148,100,47,137,62,208,24,105,201,46,175,211,85,37,147,230,26,132,96,217,187,72,211,135,167,217,125,64,210,98,15,224,85,105,33,119,11,238,216,231,134,59,34,144,205,95,120,67,145,83,99,35,156,202,117,167,63,155,93,31,65,107,213,186,241,82,231,159,119,251,85,233,145,124,96,152,195,116,66,207,161,237,3,142,163,46,110,9,78,53,250,146,39,240,160,116,4,210,228,140,196,95,66,43,184,161,214,77,50,190,32,233,180,49,125,189,77,255,141,88,235,210,122,199,150,224,25,57,1,206,111,27,196,6,152,37,68,220,1,29,242,138,9,186,42,107,197,30,89,255,151,179,229,94,197,5,108,76,185,58,145,172,73,23,51,164,107,147,200,9,101,245,127,154,10,109,166,22,216,231,14,56,181,19,190,51,14,230,42,83,120,142,70,169,38,182,77,54,176,114,192,248,59,182,75,224,100,126,83,247,55,118,224,18,62,202,32,118,157,176,221,138,30,195,253,43,91,184,247,207,15,125,71,237,115,21,174,60,220,252,89,199,66,112,173,128,223,36,111,78,134,176,102,189,163,252,95,219,127,245,139,214,236,92,17,166,132,108,157,50,17,216,169,151,73,175,206,129,101,239,137,68,22,84,48,235,95,123,17,216,132,153,114,81,224,27,93,151,45,224,194,138,75,39,129,157,5,144,44,95,72,239,146,165,250,62,6,236,32,201,48,153,9,62,99,14,161,128,48,81,213,36,232,176,200,63,25,228,7,137,37,82,169,0,45,185,247,211,128,10,202,68,165,104,231,2,62,38,179,255,56,209,168,86,3,101,211,182,55,234,102,245,214,194,158,0,202,96,28,212,154,74,133,17,108,188,87,226,197,110,32,203,228,148,190,8,92,115,252,145,97,193,109,184,245,51,218,192,148,227,104,164,62,151,175,244,50,79,31,189,239,139,161,7,192,129,33,67,248,122,15,148,26,206,79,33,169,21,120,64,218,45,126,193,113,90,222,177,67,234,28,173,149,51,254,72,20,102,244,65,139,27,80,38,131,47,238,15,93,159,112,74,123,90,33,16,115,226,37,110,143,208,158,121,87,213,104,227,112,176,233,142,162,197,229,91,172,117,188,133,51,87,249,139,174,84,240,11,53,170,38,246,143,117,206,41,123,84,167,138,182,120,42,170,197,156,236,209,162,70,213,146,60,229,25,12,210,56,179,206,75,191,88,6,182,224,58,12,199,46,73,149,82,18,97,50,28,111,59,41,246,69,11,220,150,107,199,13,35,106,181,226,147,207,124,2,54,161,76,13,236,189,222,2,58,208,86,224,126,52,2,181,117,21,85,172,124,201,136,252,167,233,131,146,250,47,136,236,20,128,94,250,171,133,26,203,55,218,188,240,75,180,221,158,140,97,239,62,180,227,75,233,155,59,134,73,20,101,186,85,212,97,249,136,63,25,96,113,241,152,30,14,248,94,67,104,225,195,249,33,103,44,187,66,100,42,4,85,23,160,100,197,73,168,40,113,66,183,235,164,116,0,126,151,208,19,85,123,4,194,162,18,125,42,24,186,118,208,252,31,162,238,65,230,22,194,179,108,214,159,202,38,175,133,73,185,111,217,167,18,138,56,153,4,223,78,161,30,149,199,119,184,221,62,212,119,30,244,145,218,17,100,36,138,252,69,171,40,103,135,251,33,214,49,112,204,93,144,166,97,48,6,192,92,116,46,140,155,37,129,49,5,146,74,127,52,90,231,211,161,44,147,200,231,41,91,129,179,205,243,116,89,219,242,71,105,238,36,176,153,53,204,78,191,157,242,87,215,24,192,90,227,13,202,170,70,182,235,81,31,254,213,65,242,220,141,77,171,218,197,8,105,171,225,89,240,34,228,180,247,21,105,5,61,84,130,32,76,186,238,110,68,51,139,24,174,9,135,53,169,13,133,88,1,228,105,131,8,51,124,61,179,108,48,144,243,64,115,52,145,101,129,154,57,174,2,84,128,159,109,16,57,244,127,80,251,202,70,118,165,190,102,15,67,165,196,142,242,190,11,251,120,158,9,216,166,14,98,234,61,188,38,208,151,196,113,254,67,186,24,91,173,226,200,13,233,159,210,122,30,163,86,196,219,22,10,225,188,136,115,196,19,36,237,183,152,40,27,180,59,16,150,25,56,80,137,209,153,221,124,38,113,225,100,175,63,208,83,29,254,193,152,203,123,81,250,95,22,76,47,217,143,163,240,210,42,110,151,79,39,98,8,76,222,186,5,239,42,161,247,74,95,41,232,52,169,203,64,96,213,135,112,208,97,138,223,178,216,250,7,116,49,86,26,75,170,54,212,22,149,47,104,142,119,37,73,227,18,108,159,215,125,233,181,99,38,118,58,137,71,250,29,133]},B={size:4,data:[3,1,6,4,2,0,7,5,6,4,3,1,7,5,2,0].map((function(e){return 32*e+16}))},U={size:6,data:[13,12,9,7,1,2,0,0,15,17,11,6,0,3,0,0,14,16,10,8,5,4,0,0,7,1,2,13,12,9,0,0,6,0,3,15,17,11,0,0,8,5,4,14,16,10,0,0].map((function(e){return 14*e+7}))},M={bayerThreshold8:P,bayerThreshold4:F,bayerThreshold2:A,blueNoiseThreshold64:I,blueNoiseThreshold16:D,halftoneThreshold8:{size:8,data:[12,6,7,13,16,20,21,17,5,0,2,8,27,30,28,22,4,1,3,9,26,31,29,23,15,11,10,14,19,25,24,18,16,20,21,17,12,6,7,13,27,30,28,22,5,0,2,8,26,31,29,23,4,1,3,9,19,25,24,18,15,11,10,14].map((function(e){return 8*e+4}))},halftoneThreshold6:U,halftoneThreshold4:B},O="\nattribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_texCoord;\nvoid main() {\n  gl_Position = a_position;\n  v_texCoord = a_texCoord;\n}",G=[-1,1,-1,-1,1,1,-1,-1,1,-1,1,1],L=[0,0,0,1,1,0,0,1,1,1,1,0],W=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=t.getContext("webgl",{preserveDrawingBuffer:!0});if(!o)throw new Error("drawImageWithShader: WebGL is unavailable");C(o),i.lastCtx!==o&&(console.log(i.lastCtx),i.program=null);var s=i.program;if(!s){var l=k(o,o.VERTEX_SHADER,O),c=k(o,o.FRAGMENT_SHADER,n);s=R(o,l,c),i.program=s}i.lastCtx=o;var h=o.getAttribLocation(s,"a_position"),d=o.getAttribLocation(s,"a_texCoord"),u=o.getUniformLocation(s,"u_image"),m=o.getUniformLocation(s,"u_thresholdMap"),g=o.getUniformLocation(s,"u_thresholdSize"),p=o.getUniformLocation(s,"u_texSize"),f=r.map((function(e){return o.getUniformLocation(s,e.name)})),x=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,x),o.bufferData(o.ARRAY_BUFFER,new Float32Array(G),o.STATIC_DRAW);var v=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,v),o.bufferData(o.ARRAY_BUFFER,new Float32Array(L),o.STATIC_DRAW),z(o,e);var w=M[a];w&&N(o,w.size,w.size,w.data,{format:o.LUMINANCE,internalFormat:o.LUMINANCE,type:o.UNSIGNED_BYTE},o.TEXTURE1),o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),o.useProgram(s),o.uniform1i(u,0),w&&(o.uniform1i(m,1),o.uniform1f(g,w.size),o.uniform2f(p,o.canvas.width,o.canvas.height)),r.forEach((function(e,t){return o.uniform1f(f[t],e.value)})),S(o,h,x,{size:2,type:o.FLOAT}),S(o,d,v,{size:2,type:o.FLOAT}),o.drawArrays(o.TRIANGLES,0,6)},X={program:null,lastCtx:null},H=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],i=(0,s.useState)(.5),a=i[0],o=i[1],l=(0,s.useState)(!1),c=l[0],h=l[1],d=null,u=null;return(0,s.useEffect)((function(){if(d)if(u)if(t||u.complete){var e=window.devicePixelRatio,r=d.getBoundingClientRect(),i=r.width*e/u.naturalWidth,o=r.height*e/u.naturalHeight,s=Math.max(i,o);d.width=u.naturalWidth*s,d.height=u.naturalHeight*s,W(u,d,"\nprecision mediump float;\nuniform sampler2D u_image;\nuniform float u_threshold;\nvarying vec2 v_texCoord;\n\nfloat luma(vec3 color) {\n  return color.x * 0.299 + color.y * 0.587 + color.z * 0.114;\n}\n\nvoid main() {\n  vec3 color = texture2D(u_image, v_texCoord).xyz;\n  float t = u_threshold;\n  color = luma(color) < t ? vec3(0.0) : vec3(1.0);\n  gl_FragColor = vec4(color, 1.0);\n}",[{name:"u_threshold",value:a}],X)}else{u.addEventListener("load",(function(){return n(!0)}),{once:!0})}else console.warn("Image unavailable");else console.warn("Canvas unavailable")}),[d,u,a,t]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:E()(f().demoFrame,f().wide),children:[(0,r.jsxs)("picture",{className:f().demoContent,children:[(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.webp",type:"image/webp"}),(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.jpeg",type:"image/jpeg"}),(0,r.jsx)("img",{src:"/content/articles/dither/tram-original.jpeg",alt:"Original image",ref:function(e){return u=e}})]}),(0,r.jsx)("canvas",{className:f().canvas,style:{opacity:c?0:1},ref:function(e){return d=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("span",{children:(0,r.jsxs)("code",{children:["t=",a.toFixed(2)]})}),(0,r.jsx)("input",{type:"range",autoComplete:"off",value:a,min:0,max:1,step:.01,onChange:function(e){return o(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Show original",(0,r.jsx)("input",{type:"checkbox",checked:c,onChange:function(e){return h(e.target.checked)}}),(0,r.jsx)("div",{className:"toggle-slider"})]})]})]})},Z={program:null,lastCtx:null},Y=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],i=(0,s.useState)(.5),a=i[0],o=(i[1],(0,s.useState)(.5)),l=o[0],c=o[1],h=(0,s.useState)(!1),d=h[0],u=h[1],m=null,g=null;return(0,s.useEffect)((function(){if(m)if(g)if(t||g.complete){var e=window.devicePixelRatio,r=m.getBoundingClientRect(),i=r.width*e/g.naturalWidth,o=r.height*e/g.naturalHeight,s=Math.max(i,o);m.width=g.naturalWidth*s,m.height=g.naturalHeight*s,W(g,m,"\nprecision mediump float;\nuniform sampler2D u_image;\nuniform float u_threshold;\nuniform float u_amplitude;\nvarying vec2 v_texCoord;\n\nfloat luma(vec3 color) {\n  return color.x * 0.299 + color.y * 0.587 + color.z * 0.114;\n}\n\nfloat rand(){\n  return fract(sin(dot(v_texCoord, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main() {\n  vec3 color = texture2D(u_image, v_texCoord).xyz;\n  float noise = u_amplitude * (rand() - 0.5);\n  float value = luma(color) + noise;\n  color = value < u_threshold ? vec3(0.0) : vec3(1.0);\n  gl_FragColor = vec4(color, 1.0);\n}",[{name:"u_threshold",value:a},{name:"u_amplitude",value:l}],Z)}else{g.addEventListener("load",(function(){return n(!0)}),{once:!0})}else console.warn("Image unavailable");else console.warn("Canvas unavailable")}),[m,g,a,l,t]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:E()(f().demoFrame,f().wide),children:[(0,r.jsxs)("picture",{className:f().demoContent,children:[(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.webp",type:"image/webp"}),(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.jpeg",type:"image/jpeg"}),(0,r.jsx)("img",{src:"/content/articles/dither/tram-original.jpeg",alt:"Original image",ref:function(e){return g=e}})]}),(0,r.jsx)("canvas",{className:f().canvas,style:{opacity:d?0:1},ref:function(e){return m=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("span",{children:(0,r.jsxs)("code",{children:["k=",l.toFixed(2)]})}),(0,r.jsx)("input",{type:"range",autoComplete:"off",value:l,min:0,max:1,step:.01,onChange:function(e){return c(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Show original",(0,r.jsx)("input",{type:"checkbox",checked:d,onChange:function(e){return u(e.target.checked)}}),(0,r.jsx)("div",{className:"toggle-slider"})]})]})]})},q=n(3932),V=n.n(q),J=[.3355752696192672,-.0885945672868057,-.018366641617918233,-.2807422461531063,-.3201837834294239,.12823271209396525,.1962856153741076,.48959793937520035,-.24859065817152592,.07719261654585563,.25542426411424923,-.427941766648418,-.09578367337916394,-.006558660890175427,.2740267067910015,.2542480373602639,-.15523101377267867,-.024223832665937306,.000776939924034159,-.23021991930076813,-.2977072935379641,.031175256669283224,-.4548917373774737,.007528872261648889,.429868005089739,.14803793582891622,.40553381473901784,.42011071990376325,.2180881637513098,.4521525298149991,-.398444940977561,.350579471909524,-.29675973230343045,-.38522542643724356,.3384682708447555,.14117811219834786,-.04874649269126363,.20450274678728997,-.3886753704744371,-.4637104089355558,-.2706227848065692,.04527160204147951,.16173314281462725,.3386488531931299,-.39087554487656395,.13119468735476947,.2548727153760296,.3184652813150496,-.36658524295179584,.1621801171561862,.1234444831955277,-.21068039436368713,-.20822711612535505,.2401707860712723,.1326438345240376,.07020279904212379,.30840701486393085,-.38958362389789647,.3635542649418486,-.30587946682731804,.11514521249401932,.10713238682084203,.4688994965502211,.3300856954260788,.3799861180061199,.041487691887627465,-.48604789958013384,-.008770841851630906,.320445655819085,-.011126017349203932,.15204090630685962,-.47596975966316823,.31299055069819404,-.4706185477860302,-.2415545275140384,.2538580074220793,-.24960862002651263,.1904626956300003,-.20078651439875728,.49250640087666453,-.43871668425424515,.42145944851142547,.012765703465875244,-.040889897125666264,-.07953310161756055,-.09619504730856199,.44313034290783726,.44724598054521436,-.23730683251987794,-.4662390817618153,.2519874983604051,.11353676875789542,.015049153406938909,.35482980000496256,.1101280651688773,.36434851247529065,.052813477648619656,.21930838390325358,-.38927827920711067,-.4211955053925476,.25197695784196406,.19878339435554526,.1823883012402142,.4414103697261932,-.2033304047721861,.430164005570707,.0654270859743521,-.08711514335324622,.14367320787286542,.09493595492267992,.16784820481480933,.05680792423455294,-.24158340448494398,-.20387176047592326,-.07359333518603328,-.0782152751400178,.16948359428068005,-.04590320090811806,-.2639696249340523,.3134321930225309,-.2017896610351232,.22330679683026078,.27128981050968903,-.2643518101791108,.08086989503856223,-.3963779474074215,.4387329463683647,.17029047892388072,.4368787890370036,-.3150045647163353,-.2814745606136779,-.27837439905483274,-.2565491437175913,-.27148337137037015,.16687072909970524,.10338840441163077,-.4460447311667026,.1415738148537955,-.33597146498836306,.18077416933653778,.05268040463822343,-.2732630735715179,.4288102521456344,.11311616754845066,.07204011297013091,-.49036514206268944,.19391851831462048,.11001903804149848,-.28612242152231326,-.34530112456569784],K=function(){var e=(0,s.useState)(.35),t=e[0],n=e[1],i=(0,s.useState)(0),a=i[0],o=i[1],l=(0,s.useState)(15),c=l[0],h=l[1],d=null;(0,s.useEffect)((function(){var e=null===d||void 0===d?void 0:d.getContext("2d");if(d&&e){var n=window.devicePixelRatio,r=d.getBoundingClientRect();d.width=r.width*n,d.height=r.height*n;var i=[d.width,d.height],o=i[0],s=i[1];e.lineWidth=2*n,e.lineCap="round";var l=[0].concat(J.slice(0,Math.min(J.length,c)),[0]),h=function(e){return e/(l.length-1)*o},u=function(e){return s*Math.max(0,Math.min(1,1-t+(l[e]||0)*a))};e.fillStyle="hsl(235, 22%, 8%)",e.fillRect(0,0,o,s),e.strokeStyle="hsla(0, 0%, 100%, 0.95)",e.beginPath(),e.moveTo(0,s/2),e.lineTo(o,s/2),e.stroke(),e.strokeStyle="hsl(345, 82%, 58%)",e.beginPath(),e.moveTo(0,u(0));for(var m=0;m<l.length-1;m++){var g=(h(m)+h(m+1))/2,p=(u(m)+u(m+1))/2,f=(g+h(m))/2,x=(g+h(m+1))/2;e.quadraticCurveTo(f,u(m),g,p),e.quadraticCurveTo(x,u(m+1),h(m+1),u(m+1))}e.stroke();for(var v=Math.max(2*n,Math.min(6*n,o/l.length/2*.75)),w=1;w<l.length-1;w++)e.fillStyle=u(w)<s/2?"white":"black",e.beginPath(),e.ellipse(h(w),u(w),v,v,0,0,2*Math.PI),e.stroke(),e.fill()}else console.warn("Canvas unavailable")}),[d,c,a,t]);var u=J.slice(0,Math.min(J.length,c)),m=u.map((function(e){return t-e*a})).filter((function(e){return e>.5})).length/u.length;return(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:E()(f().demoFrame,f().wide),children:[(0,r.jsxs)("div",{className:V().colorPreview,children:[(0,r.jsx)("div",{style:{backgroundColor:"hsl(0, 0%, ".concat(100*t,"%)")}}),(0,r.jsx)("span",{children:"Target"}),(0,r.jsx)("div",{style:{backgroundColor:"hsl(0, 0%, ".concat(100*m,"%)")}}),(0,r.jsx)("span",{children:"Sample average"})]}),(0,r.jsx)("canvas",{className:E()(f().canvas,V().canvas),ref:function(e){return d=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[(0,r.jsxs)("label",{children:["Brightness",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:t,min:0,max:1,step:.005,onChange:function(e){return n(parseFloat(e.target.value))}})]}),(0,r.jsxs)("label",{children:["Samples",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:c,min:15,max:150,step:1,onChange:function(e){return h(parseInt(e.target.value))}})]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("span",{children:(0,r.jsxs)("code",{children:["k=",a.toFixed(2)]})}),(0,r.jsx)("input",{type:"range",autoComplete:"off",value:a,min:0,max:1,step:.01,onChange:function(e){return o(parseFloat(e.target.value))}})]})]})]})},Q=[0,12,3,15,8,4,11,7,2,14,1,13,10,6,9,5],$=function(e){var t=e.showZoom,n=e.showRatio,i=e.initialRatio,a=e.showPattern,o=(0,s.useState)(1),l=o[0],c=o[1],h=(0,s.useState)(void 0===i?8:i),d=h[0],u=h[1],m=null;return(0,s.useEffect)((function(){var e=null===m||void 0===m?void 0:m.getContext("2d"),t=document.createElement("canvas"),n=t.getContext("2d");if(m&&e&&n){e.imageSmoothingEnabled=!1;var r=window.devicePixelRatio,i=m.getBoundingClientRect();m.width=i.width*r,m.height=i.height*r;var o=m.width/64,s=m.width/4,c=Math.round(o+l*(s-o));t.width=4*c,t.height=4*c;for(var h=0;h<4;h++)for(var u=0;u<4;u++){var g=Q[u%4+h%4*4],p=a?"hsl(0, 0%, ".concat(100*(g/16),"%)"):"white";n.fillStyle=g<d?p:"black",n.fillRect(u*c,h*c,c,c)}var f=e.createPattern(t,"repeat");f&&(e.fillStyle=f,e.fillRect(0,0,m.width,m.height))}else console.warn("Canvas unavailable")}),[m,a,l,d]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsx)("div",{className:f().demoFrame,children:(0,r.jsx)("canvas",{className:f().canvas,ref:function(e){return m=e}})}),(0,r.jsxs)("div",{className:f().controls,children:[t&&(0,r.jsxs)("label",{children:["Zoom",(0,r.jsx)("input",{type:"range",autoComplete:"off",value:l,min:0,max:1,step:.005,onChange:function(e){return c(parseFloat(e.target.value))}})]}),n&&(0,r.jsxs)("label",{children:[n,(0,r.jsx)("input",{type:"range",autoComplete:"off",value:d,min:0,max:16,step:1,onChange:function(e){return u(parseInt(e.target.value))}})]})]})]})},ee=n(7848),te=n.n(ee),ne=function(e){var t=e.name,n=e.label,i=e.options,a=e.value,o=e.set,s=Object.keys(i||{});return(0,r.jsxs)("div",{className:te().radio,children:[n&&(0,r.jsx)("legend",{children:n}),(0,r.jsx)("div",{children:s.map((function(e,n){return(0,r.jsxs)("label",{className:te().radioButton,children:[(0,r.jsx)("input",{type:"radio",name:t,value:e,checked:a===e,onChange:function(){return o(e)}}),(0,r.jsx)("span",{className:te().label,children:i[e]})]},n)}))})]})},re={program:null,lastCtx:null},ie=function(e){var t=e.showSizeRadio,n=(0,s.useState)(!1),i=n[0],a=n[1],o=(0,s.useState)("4"),l=o[0],c=o[1],h=(0,s.useState)(!1),d=h[0],u=h[1],m=null,g=null;return(0,s.useEffect)((function(){if(m)if(g)if(i||g.complete){var e=window.devicePixelRatio,t=m.getBoundingClientRect(),n=t.width*e/g.naturalWidth,r=t.height*e/g.naturalHeight,o=Math.max(n,r);m.width=g.naturalWidth*o,m.height=g.naturalHeight*o,W(g,m,"\nprecision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_thresholdMap;\nuniform float u_thresholdSize;\nuniform float u_useThreshold;\nuniform float u_tileSize;\nuniform vec2 u_texSize;\nvarying vec2 v_texCoord;\n\nfloat luma(vec3 color) {\n  return color.x * 0.299 + color.y * 0.587 + color.z * 0.114;\n}\n\nvec3 gamma(vec3 color) {\n  return vec3(\n    pow(color.x, 2.2),\n    pow(color.y, 2.2),\n    pow(color.z, 2.2)\n  );\n}\n\nvoid main() {\n  vec2 thresholdCoord = fract(v_texCoord * u_texSize / u_thresholdSize);\n  vec2 coord = floor(v_texCoord * u_texSize / u_tileSize) * u_tileSize / u_texSize;\n  vec3 color = texture2D(u_image, coord).xyz;\n  color = vec3(floor(color.x * 16.0 + 0.5) / 16.0);\n\n  if (u_useThreshold > 0.0) {  \n    float t = texture2D(u_thresholdMap, thresholdCoord).x;\n    color = luma(color) < t ? vec3(0.0) : vec3(1.0);\n  }\n  gl_FragColor = vec4(color, 1.0);\n}",[{name:"u_useThreshold",value:d?1:0},{name:"u_tileSize",value:parseInt(l)}],re,"bayerThreshold4")}else{g.addEventListener("load",(function(){return a(!0)}),{once:!0})}else console.warn("Image unavailable");else console.warn("Canvas unavailable")}),[m,g,d,l,i]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:E()(f().demoFrame,f().wide),children:[(0,r.jsxs)("picture",{className:f().demoContent,children:[(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.webp",type:"image/webp"}),(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.jpeg",type:"image/jpeg"}),(0,r.jsx)("img",{src:"/content/articles/dither/tram-original.jpeg",alt:"Original image",ref:function(e){return g=e}})]}),(0,r.jsx)("canvas",{className:f().canvas,ref:function(e){return m=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[t&&(0,r.jsx)(ne,{name:"demo_pattern",label:"Tile size",value:l,set:c,options:{4:"4 \xd7 4",2:"2 \xd7 2",1:"1 \xd7 1"}}),(0,r.jsxs)("label",{children:["Use pattern",(0,r.jsx)("input",{type:"checkbox",checked:d,onChange:function(e){return u(e.target.checked)}}),(0,r.jsx)("div",{className:"toggle-slider"})]})]})]})},ae={program:null,lastCtx:null},oe=function(e){var t=e.type,n=e.sizes,i=e.initial,a=(0,s.useState)(!1),o=a[0],l=a[1],c=(0,s.useState)(i||"8"),h=c[0],d=c[1],u=(0,s.useState)(!1),m=u[0],g=u[1],p=null,x=null;return(0,s.useEffect)((function(){if(p)if(x)if(o||x.complete){var e=window.devicePixelRatio,n=p.getBoundingClientRect(),r=n.width*e/x.naturalWidth,i=n.height*e/x.naturalHeight,a=Math.max(r,i);p.width=x.naturalWidth*a,p.height=x.naturalHeight*a,W(x,p,"\nprecision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_thresholdMap;\nuniform float u_thresholdSize;\nuniform vec2 u_texSize;\nvarying vec2 v_texCoord;\n\nfloat luma(vec3 color) {\n  return color.x * 0.299 + color.y * 0.587 + color.z * 0.114;\n}\n\nvec3 gamma(vec3 color) {\n  return vec3(\n    pow(color.x, 2.2),\n    pow(color.y, 2.2),\n    pow(color.z, 2.2)\n  );\n}\n\nvoid main() {\n  vec2 thresholdCoord = fract(v_texCoord * u_texSize / u_thresholdSize);\n  vec3 color = texture2D(u_image, v_texCoord).xyz;\n  color = gamma(color);\n\n  float t = texture2D(u_thresholdMap, thresholdCoord).x;\n  color = luma(color) < t ? vec3(0.0) : vec3(1.0);\n  gl_FragColor = vec4(color, 1.0);\n}",[],ae,"".concat(t,"Threshold").concat(h))}else{x.addEventListener("load",(function(){return l(!0)}),{once:!0})}else console.warn("Image unavailable");else console.warn("Canvas unavailable")}),[p,x,t,h,o]),(0,r.jsxs)("div",{className:f().container,children:[(0,r.jsxs)("div",{className:E()(f().demoFrame,f().wide),children:[(0,r.jsxs)("picture",{className:f().demoContent,children:[(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.webp",type:"image/webp"}),(0,r.jsx)("source",{srcSet:"/content/articles/dither/tram-original.jpeg",type:"image/jpeg"}),(0,r.jsx)("img",{src:"/content/articles/dither/tram-original.jpeg",alt:"Original image",ref:function(e){return x=e}})]}),(0,r.jsx)("canvas",{className:f().canvas,style:{opacity:m?0:1},ref:function(e){return p=e}})]}),(0,r.jsxs)("div",{className:f().controls,children:[(0,r.jsx)(ne,{name:"demo_".concat(t),label:"Map size",value:h,set:d,options:n}),(0,r.jsxs)("label",{children:["Show original",(0,r.jsx)("input",{type:"checkbox",checked:m,onChange:function(e){return g(e.target.checked)}}),(0,r.jsx)("div",{className:"toggle-slider"})]})]})]})},se=n(9747),le=n(5071),ce=n(7554),he=n.n(ce);function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){de(e,t,n[t])}))}return e}var me=function(e,t){var n=e.formats[e.formats.length-1];return e.formats.map((function(t){return(0,r.jsx)("source",{srcSet:"".concat(e.src,".").concat(t),type:"image/".concat(t)},t)})).concat((0,r.jsx)("img",{src:"".concat(e.src,".").concat(n),alt:e.alt,width:t}))},ge=function(e){var t,n=e.images,i=e.minSize,a=e.pixelated,o=e.noScroll,l=(0,s.useState)(null),c=l[0],h=l[1],d=(0,s.useState)(0),u=d[0],m=d[1];return(0,r.jsxs)("div",{className:E()(he().grid,(t={},de(t,he().pixelated,a),de(t,he().noScroll,o),t)),style:{"--min-size":i},children:[n.map((function(e,t){return(0,r.jsxs)("figure",{children:[(0,r.jsx)("picture",{onClick:function(t){var n=t.target.naturalWidth;h(e),m(n*(a?function(){var e=window.devicePixelRatio;return Math.round(e)/e}():1))},children:me(e)}),e.caption&&(0,r.jsx)("figcaption",{children:e.caption})]},t)})),(0,r.jsx)(se.Z,{children:c&&(0,r.jsx)(le.Z,{classNames:ue({},he()),timeout:500,children:(0,r.jsxs)("div",{className:he().viewOverlay,onClick:function(){return h(null)},children:[(0,r.jsx)("div",{className:he().closeHint,children:"Click anywhere to close"}),(0,r.jsxs)("figure",{className:he().viewFigure,children:[(0,r.jsx)("picture",{children:me(c,u)}),c.caption&&(0,r.jsx)("figcaption",{children:c.caption})]})]})})})]})},pe=function(e){var t=e.children;return(0,r.jsx)(g,{meta:fe,children:t})},fe={title:"Dithering: a\xa0visual introduction"};var xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=function(){var t=Object.assign({h2:"h2",p:"p",em:"em",a:"a",ul:"ul",li:"li",code:"code",pre:"pre",h3:"h3"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{children:"What is dithering?"}),"\n",(0,r.jsx)(t.p,{children:"Dither is noise introduced to an image to reduce large-scale patterns like color banding when using a limited color palette. In other words, it's a way to trick the eye into seeing more colors than are actually being displayed."}),"\n",(0,r.jsx)(t.p,{children:"The human eye can only see detail up to a certain point, beyond which it starts to blur things together. The image below is a grid of alternating black and white tiles. Try zooming all the way out by dragging the Zoom slider to the left:"}),"\n",(0,r.jsx)(v,{showZoom:!0}),"\n",(0,r.jsx)(t.p,{children:"At larger sizes, the tiles are clearly visible, but as you zoom out they start to blend together into gray. This is an illusion: your display is really only showing pure black and white pixels, but your eyes can't see that much detail and instead mix together equal parts black and white into gray."}),"\n",(0,r.jsx)(t.p,{children:"The last example used an equal amount of black and white tiles, resulting in a 50% gray. We can change the shade of the perceived color by making more or fewer of the \u201ctiles\u201d or pixels black or white. Try moving the brightness slider toward both ends:"}),"\n",(0,r.jsx)(v,{showZoom:!0,showRatio:"Brightness"}),"\n",(0,r.jsxs)(t.p,{children:["By altering the ",(0,r.jsx)(t.em,{children:"ratio"})," of white to black pixels, we can make the resulting gray brighter or darker. More white pixels make the rectangle lighter on average, and so it looks brighter, while more black pixels make it darker. At each end, all pixels are either black or white and that's the color you see."]}),"\n",(0,r.jsx)(t.p,{children:"This doesn't just work for black and white, rather, we can use it to \u201cmix\u201d any two colors:"}),"\n",(0,r.jsx)(v,{showZoom:!0,showRatio:"Balance",color1:"blue",color2:"red"}),"\n",(0,r.jsx)(t.p,{children:"And the effect isn't limited to just two colors, either. In the example below, black is mixed with the three RGB primaries to approximate almost any color. You can play around with the RGB sliders to change the \u201ctarget\u201d color we're trying to match, which is shown in the box at the top."}),"\n",(0,r.jsx)(y,{}),"\n",(0,r.jsx)(t.p,{children:"This is the working principle of dithering: by mixing a few base colors in tiny patterns, we can trick our eyes into seeing the shades in between that we can't actually display."}),"\n",(0,r.jsxs)(t.h2,{children:[(0,r.jsx)(t.em,{children:"Why"})," dithering?"]}),"\n",(0,r.jsxs)(t.p,{children:["Modern displays and image formats can display some 16.7 ",(0,r.jsx)(t.em,{children:"million"})," colors. That's a lot. This hasn't always been the case, though. Back in the early days of computers, most devices had monochrome screens with only a few brightness levels. Early color displays supported as few as 16 or even just ",(0,r.jsx)(t.em,{children:"four"})," colors at a time. Even as late as the early 2000s there were still people using 256-color displays\u2014hence the 216-color \u201cweb safe\u201d palette\u2014and some popular image formats were limited to a 256 color palette as well."]}),"\n",(0,r.jsx)(t.p,{children:"In these low-color scenarios, dithering helps reduce color banding and effectively increases the number of colors we can display. Generally speaking, dithered images just look much better (click each image to view in detail):"}),"\n",(0,r.jsx)(ge,{pixelated:!0,images:[{src:"/content/articles/dither/boat-original",formats:["webp","jpeg"],alt:"Original image",caption:"24-bit \u201ctrue color\u201d"},{src:"/content/articles/dither/boat-web",formats:["webp","jpeg"],alt:"Web safe image",caption:"Web safe palette (216 colors)"},{src:"/content/articles/dither/boat-web-dither",formats:["webp","jpeg"],alt:"Dithered image",caption:"Web safe palette, dithered"}]}),"\n",(0,r.jsxs)(t.p,{children:["These days, most displays are capable of showing ",(0,r.jsx)(t.em,{children:"at least"})," 16.7 million colors, and modern compression algorithms are ",(0,r.jsx)(t.a,{href:"https://www.simplethread.com/why-your-website-should-not-use-dithered-images/",children:"far more effective"})," at reducing file size while preserving colors and detail than any form of dithering with reduced color depth. Nevertheless, dithering is still useful in some situations, and can also be used for aesthetic effect."]}),"\n",(0,r.jsx)(t.h2,{children:"How dithering works"}),"\n",(0,r.jsxs)(t.p,{children:["We've seen how we can create different colors by mixing a few base colors\u2014we'll call these ",(0,r.jsx)(t.em,{children:"primaries"}),". In this section we'll explore different ways to decide where to mix which primaries to best reproduce the original, full-color image. To make things simpler and the effects of dithering clearer, we'll go back to pure black and white for the moment."]}),"\n",(0,r.jsx)(t.p,{children:"Dithering algorithms will be presented in pseudocode along an interactive demonstration of the results, following some conventions:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"input"})," and ",(0,r.jsx)(t.code,{children:"output"})," are image buffers. Pixels are read and set by ",(0,r.jsx)(t.code,{children:"[x, y]"})," coordinates."]}),"\n",(0,r.jsxs)(t.li,{children:["Images are assumed to be grayscale unless otherwise specified. Grayscale pixel values are referred to as ",(0,r.jsx)(t.code,{children:"value"})," and treated as numbers, while color pixel values are referred to as ",(0,r.jsx)(t.code,{children:"color"})," and have ",(0,r.jsx)(t.code,{children:"r"}),", ",(0,r.jsx)(t.code,{children:"g"}),", and ",(0,r.jsx)(t.code,{children:"b"})," number members."]}),"\n",(0,r.jsx)(t.li,{children:"Values (grayscale or RGB) are in the range [0,\xa01]."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The interactive demos will use this grayscale image:"}),"\n",(0,r.jsx)(ge,{noScroll:!0,images:[{src:"/content/articles/dither/tram-original",formats:["webp","jpeg"],alt:"Original image"}]}),"\n",(0,r.jsx)(t.h2,{children:"Thresholding"}),"\n",(0,r.jsxs)(t.p,{children:["Thresholding is the conversion to a reduced color range itself: the brightness or color values for each pixel are compared against a numerical ",(0,r.jsx)(t.em,{children:"threshold"})," to determine which color will be used. While not dithering in itself, all dithering methods do this at some point, so it's a good place to start."]}),"\n",(0,r.jsx)(t.p,{children:"The thresholding process for converting grayscale to black and white is very simple:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"for (x, y) in input\n  value = input[x, y]\n  output[x, y] = if (value < t) 0; else 1\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Where ",(0,r.jsx)(t.code,{children:"t"})," is the threshold that controls whether a certain value should resolve to black or white. Try dragging the slider for ",(0,r.jsx)(t.code,{children:"t"})," towards each end."]}),"\n",(0,r.jsx)(H,{}),"\n",(0,r.jsx)(t.p,{children:"When dithering, we'll always use a balanced threshold value of 0.5."}),"\n",(0,r.jsx)(t.h2,{children:"Random dithering"}),"\n",(0,r.jsx)(t.p,{children:"This is the simplest form of dithering: it just adds random noise to the image before reducing the colors. Random noise dithering code might look something like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"for (x, y) in input\n  value = input[x, y]\n  noise = k * (random(0, 1) - 0.5)\n  output[x, y] = if (value + noise < 0.5) 0; else 1\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The parameter ",(0,r.jsx)(t.code,{children:"k"})," controls the amplitude or \u201camount\u201d of noise applied to the image. You can try it out below:"]}),"\n",(0,r.jsx)(Y,{}),"\n",(0,r.jsx)(t.p,{children:"This works because we're adding some \u201cfuzziness\u201d to the image, making some pixels pass the threshold when they normally wouldn't. Below is a visual demonstration of how noise dithering works."}),"\n",(0,r.jsxs)(t.p,{children:["The graph takes a one-dimensional \u201cslice\u201d of a flat gray color shown in the \u201ctarget\u201d box, placing brightness along the y axis. The ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.code,{children:"white line"})})," indicates the threshold, while the points connected by the ",(0,r.jsx)(t.code,{children:"red line"})," represent sampled points (in a real image, these would be pixels). The color of each point is its value after thresholding. The \u201csample average\u201d box shows the average of all sampled points ",(0,r.jsx)(t.em,{children:"after"})," thresholding."]}),"\n",(0,r.jsxs)(t.p,{children:["As you can see, for the initial brightness level of 35% the sample average is black, because 35% is less than the 50% threshold and so ",(0,r.jsx)(t.em,{children:"all"})," points become black. Try adding some noise by dragging the ",(0,r.jsx)(t.code,{children:"k"})," slider all the way to the right:"]}),"\n",(0,r.jsx)(K,{}),"\n",(0,r.jsx)(t.p,{children:"As you add noise, some points go above the threshold and become white, bringing the average closer to the original 35% gray. Because the noise is \u201ccentered\u201d around the original brightness, the average value will tend to get closer to the value as you add more samples. Try playing around with different brightness levels, noise levels, and sample sizes before moving on."}),"\n",(0,r.jsx)(t.p,{children:"The problem with this approach becomes clear by looking at the results: among other things, it just looks bad. While adding random noise does help approximate the right proportions of black and white for each part of the image, it drowns out most details and the results are, expectedly, noisy. We can do better."}),"\n",(0,r.jsx)(t.h2,{children:"Error diffusion"}),"\n",(0,r.jsxs)(t.p,{children:["Error diffusion dithering is simple in principle and very effective. Instead of just adding noise at random, we measure the ",(0,r.jsx)(t.em,{children:"error"})," for a pixel (how much we \u201cmissed\u201d by when assigning a primary), and then distribute or ",(0,r.jsx)(t.em,{children:"diffuse"})," that error along adjacent pixels. This way if we made a pixel darker than it should be, we'll make the adjacent pixels a little brighter to compensate, and viceversa. An error diffusion algorithm might look something like this:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"number[x, y] errorMap // Error for each pixel, initialized to zero\n\nfor (x, y) in input\n  value = input[x, y] + errorMap[x, y]\n  output[x, y] = if (value < 0.5) 0; else 1\n\n  error = value - output[x, y]\n\n  // Error diffusion across pixels to the right and below\n  errorMap[x + 1, y] = error / 2\n  errorMap[x, y + 1] = error / 2\n"})}),"\n",(0,r.jsx)(t.p,{children:"The result looks like this (Click to view in detail):"}),"\n",(0,r.jsx)(ge,{pixelated:!0,noScroll:!0,images:[{src:"/content/articles/dither/tram-original",formats:["webp","jpeg"],alt:"Original image",caption:"Original image"},{src:"/content/articles/dither/tram-ed-simple",formats:["webp","jpeg"],alt:"Error Diffusion dithered",caption:"Error Diffusion dithering"}]}),"\n",(0,r.jsx)(t.p,{children:"While there are still noticeable patterns, this is already much cleaner than simple random noise dithering. However, we can improve the error diffusion algorithm even further."}),"\n",(0,r.jsxs)(t.p,{children:["The above implementation uses an overly simplified ",(0,r.jsx)(t.em,{children:"diffusion pattern"}),": half the error is propagated to the pixel to the right, half to the pixel below. If we were to draw it as a matrix, it would look something like this:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"* 1\n1 .\n\n(/2)\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Where ",(0,r.jsx)(t.code,{children:"*"})," is the source pixel, and each number represents the portion of error propagated to that pixel. ",(0,r.jsx)(t.code,{children:"(/2)"})," indicates that all numbers are divided by two."]}),"\n",(0,r.jsx)(t.p,{children:"In practice, more complex diffusion patterns are used to achieve better results. Patterns that distribute error across more pixels usually result in a smoother image. You can compare some of the most popular ones below (click each image to view in detail):"}),"\n",(0,r.jsx)(ge,{minSize:"30ch",pixelated:!0,images:[{src:"/content/articles/dither/tram-ed-fs",formats:["webp","jpeg"],alt:"Floyd-Steinberg",caption:"Floyd-Steinberg"},{src:"/content/articles/dither/tram-ed-jjn",formats:["webp","jpeg"],alt:"Minimum Average Error",caption:"Minimum Average Error"},{src:"/content/articles/dither/tram-ed-stucki",formats:["webp","jpeg"],alt:"Stucki",caption:"Stucki"},{src:"/content/articles/dither/tram-ed-sierra",formats:["webp","jpeg"],alt:"Sierra",caption:"Sierra"}]}),"\n",(0,r.jsx)(t.p,{children:"Error diffusion is a much better algorithm than simple random noise, and is often used for dithering static images. It works especially well with very large color palettes, for example, when reducing a camera's 14-bit image to standard 8-bit color. It's not without its drawbacks, however. With limited palettes, error diffusion dithering can produce very visible noise, color bands and \u201cghosts\u201d as seen in the image below:"}),"\n",(0,r.jsx)(ge,{pixelated:!0,noScroll:!0,images:[{src:"/content/articles/dither/flower",formats:["webp","jpeg"],alt:"Error dithering artifacts"}]}),"\n",(0,r.jsx)(t.p,{children:"The other major drawback is related to the way error diffusion works: because the final value of a pixel depends on every single pixel that came before it, it can't be used with parallel processing (for instance in GPUs). This makes it rather slow to compute in real time, which is why you didn't see any interactive examples in this section."}),"\n",(0,r.jsx)(t.p,{children:"Also because of this, it doesn't work very well for animation or video, as a single pixel change can make the entire image shift around:"}),"\n",(0,r.jsx)(ge,{pixelated:!0,noScroll:!0,images:[{src:"/content/articles/dither/tram-motion-original",formats:["gif"],alt:"Error dithering animation",caption:"Original animation, with a single moving pixel"},{src:"/content/articles/dither/tram-motion-ed",formats:["webp","gif"],alt:"Error dithering animation",caption:"Noise patterns shift throughout the image"}]}),"\n",(0,r.jsx)(t.p,{children:"Next up, we'll look at a dithering method that solves these issues."}),"\n",(0,r.jsx)(t.h2,{children:"Ordered dithering"}),"\n",(0,r.jsx)(t.p,{children:"An ordered dithering algorithm solves the problems of error diffusion by making the calculations for each pixel entirely independent from each other. We can use the random noise example from earlier as a starting point:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"for (x, y) in input\n  value = input[x, y]\n  noise = k * (random(0, 1) - 0.5)\n  output[x, y] = if (value + noise < 0.5) 0; else 1\n"})}),"\n",(0,r.jsx)(Y,{}),"\n",(0,r.jsx)(t.p,{children:"This algorithm is stateless: it doesn't keep any internal state, and operates on each pixel independently. In other words, there's no code outside the main pixel loop."}),"\n",(0,r.jsxs)(t.p,{children:["This example can be rewritten to think of the noise as adding to the ",(0,r.jsx)(t.em,{children:"threshold"}),", rather than the input:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"for (x, y) in input\n  value = input[x, y]\n  noise = k * (random(0, 1) - 0.5)\n  threshold = 0.5 + noise\n  output[x, y] = if (value < threshold) 0; else 1\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This method is already very close to ordered dithering. Ordered dithering differs from our random noise example in that the threshold is sampled from a predetermined ",(0,r.jsx)(t.em,{children:"threshold map"}),", rather than calculated randomly:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"number[n, m] thresholdMap // Threshold map of size n * m\n// Initialize threshold map with some values\n\nfor (x, y) in input\n  value = input[x, y]\n  threshold = thresholdMap[x % n, y % m]\n  output[x, y] = if (value < threshold) 0; else 1\n"})}),"\n",(0,r.jsxs)(t.p,{children:["We also lose the parameter ",(0,r.jsx)(t.code,{children:"k"}),", which controls the noise profile in the previous example. Here, the threshold map provides all the information we need."]}),"\n",(0,r.jsx)(t.p,{children:"The threshold map doesn't need to be the same size as the image: it is \u201ctiled\u201d as many times as necessary in both dimensions. This leaves only the matter of filling our threshold map with some values."}),"\n",(0,r.jsx)(t.h3,{children:"Understanding threshold maps"}),"\n",(0,r.jsx)(t.p,{children:"To understand what threshold maps are and why they work, let's go back to the very first example with the black and white tiles. Try dragging the slider all the way to the right:"}),"\n",(0,r.jsx)($,{showRatio:"Brightness",initialRatio:0}),"\n",(0,r.jsx)(t.p,{children:"As the amount of white pixels increases, the entire square becomes brighter. The square is 16 (4\xd74) pixels in size and has a total of 17 possible brightness levels, from no white pixels to all 16."}),"\n",(0,r.jsx)(t.p,{children:"Knowing this, if we can reduce our image to 4\xd74 pixel tiles and 17 brightness levels, we can assign a pattern to each possible brightness:"}),"\n",(0,r.jsx)(ie,{}),"\n",(0,r.jsx)("div",{className:"note",children:(0,r.jsxs)(t.p,{children:["You might notice the image looks too bright and washed out when using the patterns. This happens because we're not doing any ",(0,r.jsx)(t.em,{children:"gamma correction"}),". What gamma correction is and why it's necessary will be explained in the next article in this series."]})}),"\n",(0,r.jsx)(t.p,{children:"The problem with this approach is we lose a lot of resolution: As long as we assign one pattern per tile, the number of brightness levels is limited by the size of the tiles. Instead, we can reduce the tile size, and have the 4\xd74 pattern cover multiple tiles. Try changing the tile size to 2\xd72 or even 1\xd71:"}),"\n",(0,r.jsx)(ie,{showSizeRadio:!0}),"\n",(0,r.jsx)(t.p,{children:"At a tile size of 1\xd71, each tile covers a single pixel\u2014there is no resolution loss at all! This is how ordered dithering works: each pixel takes its color from a different part of the repeating pattern, depending on its own value."}),"\n",(0,r.jsx)(t.h3,{children:"Threshold map patterns"}),"\n",(0,r.jsx)(t.p,{children:"Let's go back to the grid example one last time. Drag the slider slowly towards the highest brightness, paying attention to the position of white pixels:"}),"\n",(0,r.jsx)($,{showZoom:!0,showRatio:"Brightness",initialRatio:0}),"\n",(0,r.jsxs)(t.p,{children:["As you increase brightness, white pixels start appearing in a certain pattern. We can see the pattern more clearly by painting each tile with the brightness it needs to be \u201cturned on\u201d\u2014in other words, its ",(0,r.jsx)(t.em,{children:"threshold"}),"\u2014instead of white:"]}),"\n",(0,r.jsx)($,{showZoom:!0,showPattern:!0,showRatio:"Brightness",initialRatio:0}),"\n",(0,r.jsx)(t.p,{children:"The pattern you see in this last example with brightness turned all the way up is the actual threshold map. Try zooming out to see it repeating."}),"\n",(0,r.jsxs)(t.p,{children:["This pattern is a 4\xd74 ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Ordered_dithering#Threshold_map",children:"bayer matrix"}),", a common threshold map for ordered dithering. It is a mathematically defined matrix of size N \xd7 M, containing all values in the range ",(0,r.jsx)(t.code,{children:"[0; M \xd7 N)"})," such that each number is as far as possible from its immediate succesor. For example, the smallest 2\xd72 bayer matrix is"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"0 3\n2 1\n"})}),"\n",(0,r.jsxs)(t.p,{children:["For dithering, the matrix is normalized: every value is divided by ",(0,r.jsx)(t.code,{children:"N \xd7 M"}),", so we get threshold values between 0 and 1. Ordered dithering with a bayer matrix is mathematically very accurate, but produces noticeable artifacts in the form of a characteristic cross-hatch pattern. You can try out different matrix sizes below:"]}),"\n",(0,r.jsx)(oe,{type:"bayer",sizes:{2:"2 \xd7 2",4:"4 \xd7 4",8:"8 \xd7 8"}}),"\n",(0,r.jsx)(t.p,{children:"The cross-hatch pattern produced by a bayer matrix can sometimes be desirable for aesthetic reasons, but might also be unwanted. In these cases, a threshold map without any discernible patterns would be best. Random white noise, as we've seen, doesn't work. Ideally we want something with as few \u201clarge scale\u201d or low-frequency patterns as possible: blue noise."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"http://momentsingraphics.de/BlueNoise.html",children:"Generating blue noise"})," is outside the scope of this article. For our purposes, we can just use pre-generated blue noise textures as a threshold map (the ",(0,r.jsx)(t.a,{href:"http://momentsingraphics.de/BlueNoise.html",children:"linked site"})," has plenty available to download). You can try out ordered dithering with a blue noise threshold map below:"]}),"\n",(0,r.jsx)(oe,{type:"blueNoise",sizes:{16:"16 \xd7 16",64:"64 \xd7 64"},initial:"64"}),"\n",(0,r.jsx)(t.p,{children:"Other patterns can be used as well\u2014there's no restriction to what can be in a threshold map. For example, it can be used to form a coarse, halftone-like pattern:"}),"\n",(0,r.jsx)(oe,{type:"halftone",sizes:{4:"4 \xd7 4",6:"6 \xd7 6",8:"8 \xd7 8"}}),"\n",(0,r.jsx)(t.p,{children:"Ordered dithering is the most versatile method: it can be used with any number of patterns to achieve different looks, and because each pixel is processed independently it is ideal for animation or moving images. The algorithm can also be implemented on the GPU, which makes real-time dithering feasible."}),"\n",(0,r.jsx)(t.h2,{children:"Conclusion"}),"\n",(0,r.jsxs)(t.p,{children:["So far, we've learned what dithering is, why it's useful (or fun), and how it works. In the next part, we'll explore how we can expand our dithering algorithms to work in color, with an arbitrary set of primaries or ",(0,r.jsx)(t.em,{children:"color palette"}),"."]})]})};return pe?(0,r.jsx)(pe,Object.assign({},e,{children:(0,r.jsx)(t,{})})):t()}},8561:function(e){e.exports={container:"DemoCommon_container__wCuSx",demoFrame:"DemoCommon_demoFrame__sy1dG",wide:"DemoCommon_wide__AEvp5",noBorder:"DemoCommon_noBorder__QIrV4",canvas:"DemoCommon_canvas__RJB50",demoContent:"DemoCommon_demoContent__zWTmZ",controls:"DemoCommon_controls___YFhV",withValueLabel:"DemoCommon_withValueLabel__baVOn"}},9868:function(e){e.exports={colorPreview:"DemoDitherRGB_colorPreview__fBxyZ"}},3932:function(e){e.exports={colorPreview:"DemoRandomGraph_colorPreview__kmBHL",canvas:"DemoRandomGraph_canvas__xjhb3"}},2071:function(e){e.exports={layoutRoot:"Common_layoutRoot__VcayH",mainContent:"Common_mainContent__JJZd4",header:"Common_header__jh1_2",settings:"Common_settings__PgHOK",bigLinks:"Common_bigLinks__BuFz3"}},5957:function(e){e.exports={crumbs:"Crumbs_crumbs__ETs2q",crumb:"Crumbs_crumb__7lg_0"}},867:function(e){e.exports={expandToggle:"ExpandToggle_expandToggle__BYlBk",toggled:"ExpandToggle_toggled__8Hslv"}},7584:function(e){e.exports={fontToggle:"FontToggle_fontToggle__ojJQ1",sans:"FontToggle_sans__hUf61",serif:"FontToggle_serif__qkIvr",toggled:"FontToggle_toggled___ZGs_"}},7554:function(e){e.exports={grid:"ImageGrid_grid__gBvFf",noScroll:"ImageGrid_noScroll___lpY0",viewOverlay:"ImageGrid_viewOverlay__xjNSK",pixelated:"ImageGrid_pixelated__S3xRt",closeHint:"ImageGrid_closeHint__67B2q",enter:"ImageGrid_enter__BvDjc",exitActive:"ImageGrid_exitActive__g0d3g",exitDone:"ImageGrid_exitDone__ob4F3",exit:"ImageGrid_exit__S7cPc",enterActive:"ImageGrid_enterActive__apyH0",enterDone:"ImageGrid_enterDone__5i4fM"}},7848:function(e){e.exports={radio:"Radio_radio__8MF3k",radioButton:"Radio_radioButton__uCmNT",label:"Radio_label__O9_rk"}},2754:function(e){e.exports={progress:"ScrollProgress_progress__XLEnH"}},1818:function(e){e.exports={anchor:"Settings_anchor__3UI96",container:"Settings_container__lx6oR",tooltip:"Settings_tooltip__FeCx6",expandToggle:"Settings_expandToggle__2bdJ3",expanded:"Settings_expanded__6zW9E"}},2729:function(e){e.exports={themeToggle:"ThemeToggle_themeToggle__1UodW",toggled:"ThemeToggle_toggled__ykoPB",themeToggleCircle:"ThemeToggle_themeToggleCircle__elMqT",themeToggleInner:"ThemeToggle_themeToggleInner__B9q16"}}},function(e){e.O(0,[562,774,888,179],(function(){return t=8335,e(e.s=t);var t}));var t=e.O();_N_E=t}]);